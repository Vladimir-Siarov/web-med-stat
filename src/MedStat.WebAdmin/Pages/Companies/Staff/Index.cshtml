@page "/Companies/{CompanyId:int}/Staff/"

@using MedStat.WebAdmin.Classes
@using MedStat.WebAdmin.Classes.SharedResources
@using MedStat.WebAdmin.Models
@using Microsoft.AspNetCore.Mvc.Localization
@using Microsoft.Extensions.Localization

@model CompanyStaffPageModel

@inject IHtmlLocalizer<CompanyResource> CmpLocalizer
@inject IStringLocalizer<DialogResources> DlgLocalizer

@{
	Layout = "_CompanyLayout";

	ViewData.SetDataTablePageFlag();

	var staffSearchPanelModel = new DataTableSearchPanelModel("tblStaff");
}

<div class="ms-under-construction">Страница в разработке</div>

<div class="ms-pagecontent">

	<div class="ms-section-header">
		<div>
			<button id="btnCreateNewCmpUser" class="btn btn-success btn-sm" data-action="create">
				<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-plus" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
					<path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
				</svg>@CmpLocalizer["__button__Create employee"]
			</button>
		</div>

		<partial name="_DtSearchPanelPartial" model="@staffSearchPanelModel" />
	</div>


	<table id="tblStaff"
				 class="table table-hover caption-top" style="width: 100%"
				 data-auto-width="false"
				 data-ms-page-length-control="#@staffSearchPanelModel.PageLengthControlId"
				 data-ms-search-control="#@staffSearchPanelModel.SearchControlId">
		<caption>@CmpLocalizer["Employee list"]</caption>
		<thead>
			<tr>
				<th data-data="id" data-width="5%">Id</th>
				<th data-data="surname" data-width="15%">@CmpLocalizer["__CmpUserGrid_Column__Surname"]</th>
				<th data-data="firstName" data-width="15%">@CmpLocalizer["__CmpUserGrid_Column__First name"]</th>
				<th data-data="patronymic" data-width="15%">@CmpLocalizer["__CmpUserGrid_Column__Patronymic"]</th>
				<th data-data="temperature" data-width="10%" data-ms-html-template="#tblStaff_temperatureTemplate">@CmpLocalizer["__StaffGrid_Column__Temperature"]</th>
				<th data-data="position" data-width="auto" data-ms-max-length="50">@CmpLocalizer["__StaffGrid_Column__Position"]</th>
				<th data-data="inventoryNumber" data-width="10%">
					<span class="ms-datable-icon ms-icon-devicetype-smartwatch" data-device-type="SmartWatch" 
					      title="Инвентарный # назначенного устройства"></span>
				</th>
				<th data-orderable="false" data-width="5%" data-class-name="buttons" data-ms-html-template="#tblStaff_buttonsTemplate">
					<!-- buttons -->
				</th>
			</tr>
		</thead>
	</table>

	<div id="tblStaff_buttonsTemplate" style="display: none">
		<button type="button" class="btn btn-link" title="@CmpLocalizer["__button__Edit"]"
		        data-action="edit" data-user-id="{id}">
			<span class="ms-datable-icon ms-icon-grid-edit"></span>
			<span class="visually-hidden">@CmpLocalizer["__button__Edit"]</span>
		</button>

		<button type="button" class="btn btn-link" title="@CmpLocalizer["__button__Delete"]"
		        data-action="delete" data-user-id="{id}">
			<span class="ms-datable-icon ms-icon-grid-delete"></span>
			<span class="visually-hidden">@CmpLocalizer["__button__Delete"]</span>
		</button>
	</div>
	
	<div id="tblStaff_temperatureTemplate" style="display: none">
		<span data-temperature="{temperature}">
			{temperature}
		</span>
	</div>

</div>


@section Scripts
{
	<script type="text/javascript">

		window.pageInit = function() {

			// Grid functionality:

			var onUserActionBtnClick = function() {

				alert('Функциональность в разработке');
			};

			var stuffData = [
				{
					id: 1,
					surname: 'Семёнов',
					firstName: 'Сергей',
					patronymic: 'Александрович',
					temperature: 36.4,
					position: 'менеджер по продажам',
					inventoryNumber: '0001'
				},
				{
					id: 2,
					surname: 'Петров',
					firstName: 'Николай',
					patronymic: 'Сергеевич',
					temperature: 36.5,
					position: 'менеджер по продажам',
					inventoryNumber: '0002'
				},
				{
					id: 3,
					surname: 'Смирнова',
					firstName: 'Эльвира',
					patronymic: 'Андреевна',
					temperature: 37.5,
					position: 'старший бухгалтер',
					inventoryNumber: '0003'
				},
				{
					id: 4,
					surname: 'Смирнов',
					firstName: 'Антон',
					patronymic: 'Николаевич',
					temperature: 36.5,
					position: 'менеджер по закупкам',
					inventoryNumber: '0004'
				},
				{
					id: 5,
					surname: 'Серов',
					firstName: 'Андрей',
					patronymic: 'Витальевич',
					temperature: 36.4,
					position: 'менеджер по закупкам',
					inventoryNumber: '0005'
				}
			];


			$('#btnCreateNewCmpUser').click(onUserActionBtnClick);

			$('#tblStaff')
				.on('draw.dt',
					function() {

						// init grid buttons
						$('#tblStaff button').click(onUserActionBtnClick);

						// init grid temperature
						$('#tblStaff [data-temperature]').each(function() {

							var $t = $(this);
							var temperature = parseFloat($t.attr('data-temperature'));

							if (temperature !== NaN && temperature >= 37.5) {
								$t.addClass('ms-temperature-danger');
								$t.closest('tr').addClass('ms-temperature-danger');
							}
						});
					})
				.msDataTable({ // init grid
					data: stuffData,
					serverSide: false
				});
		};

	</script>
}