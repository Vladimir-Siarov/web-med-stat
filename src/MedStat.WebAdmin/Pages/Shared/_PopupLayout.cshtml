@using MedStat.WebAdmin.Models
@using MedStat.WebAdmin.Classes
@using MedStat.WebAdmin.Classes.SharedResources
@using Microsoft.AspNetCore.Mvc.Localization
@using Microsoft.Extensions.Localization

@model IPopupLayoutData

@inject IStringLocalizer<DataTableResource> DtLocalizer
@inject IHtmlLocalizer<DialogResources> DlgLocalizer

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>@ViewData["Title"] - МедСтат.Админ</title>

	<!-- Bootstrap and site CSS -->
	<link rel="stylesheet" href="~/css/bootstrap.css" />
	@if (ViewData.IsDataTablePage())
	{
		<!--DataTables.net-->
		<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap5.min.css">
	}
	<link rel="stylesheet" href="~/css/ms.css" />
</head>
<body>

	@if (ViewData["success_message"] != null)
	{
		<div class="alert alert-success" role="alert">
			@ViewData["success_message"]
		</div>
	}

	@if (ViewData["error_message"] != null)
	{
		<div class="alert alert-danger" role="alert">
			@ViewData["error_message"]
		</div>
	}

	<main role="main" class="ms-popup-pagecontainer">
		@RenderBody()
	</main>

	<div id="popupOverlay" class="ms-popup-overlay" style="display: none">
		<span class="spinner-border" role="status"></span>
		<span class="visually-hidden">@DlgLocalizer["Processing..."]</span>
	</div>

	<!-- Bootstrap Bundle with Popper.js -->
	<script async src="~/js/bootstrap.bundle.min.js"></script>

	<!-- Cookie -->
	<script async src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>

	<!-- jQuery -->
	<script defer type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<!-- jQuery Unobtrusive Ajax-->
	<script defer type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajax-unobtrusive/3.2.6/jquery.unobtrusive-ajax.min.js"></script>

	<script defer src="~/js/jquery.ms.js" asp-append-version="true"></script>
	@*<script defer src="~/js/site.js" asp-append-version="true"></script>*@

	@if (ViewData.IsDataTablePage())
	{
		<!-- DataTables.net -->
		<script defer src="//cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
		<script defer src="//cdn.datatables.net/1.10.22/js/dataTables.bootstrap5.min.js"></script>

		<script type="text/javascript">
			window.msDataTableOptions = {
				language: @(Html.Raw(Json.Serialize(DataTableHelper.GetDataTableLanguageConfig(DtLocalizer))))
			};
		</script>
	}

<script type="text/javascript">
		window.addEventListener('load', (event) => {
			
			if (window.parent != null && window.parent.$ != null) {

				var parentWindow = window.parent.$(window.parent);

				parentWindow.trigger('ms_popup_loaded', [{ title: '@ViewData["Title"]' }]);

				@if (Model.EntityWasCreated)
				{
					<text> parentWindow.trigger('ms_popup_entityWasCreated', []); </text>
				}
				@if (Model.EntityWasUpdated)
				{
					<text> parentWindow.trigger('ms_popup_entityWasUpdated', []); </text>
				}
				@if (Model.EntityWasDeleted)
				{
					<text> parentWindow.trigger('ms_popup_entityWasDeleted', []); </text>
				}
			}
		});

		window.addEventListener('unload', (event) => {

			$('#popupOverlay').show();
		});
</script>

	@await RenderSectionAsync("Scripts", required: false)
</body>
</html>
